#!/usr/bin/env bash
set -eo pipefail
REPO_ROOT="$(git rev-parse --show-toplevel 2>/dev/null || echo .)"
[ -f "$REPO_ROOT/ci/parity.lock.json" ] || exit 0

# Tag this as a pre-commit hook (enables fast self-check mode)
export GIT_HOOK=pre-commit

# Use unified ft pre-commit command
if [ -x "$REPO_ROOT/.venv-parity/bin/ft" ]; then
  "$REPO_ROOT/.venv-parity/bin/ft" pre-commit
elif command -v ft >/dev/null 2>&1; then
  ft pre-commit
else
  # Fallback: activate venv and call CLI module
  [ -x "$REPO_ROOT/.venv-parity/bin/python" ] && . "$REPO_ROOT/.venv-parity/bin/activate"
  python -m firsttry.cli pre-commit
fi
