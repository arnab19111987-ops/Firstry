name: CI guards and fast integration

on:
  pull_request:
    branches: ["main"]
  push:
    branches: ["tmp/change-logger-smoke", "main"]

jobs:
  guards:
    name: Static guards + fast integration tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
      - name: Install deps (minimal)
        run: |
          python -m pip install --upgrade pip
          pip install pytest
      - name: Run CI guard script
        run: |
          python scripts/ci_checks.py
      - name: Run fast integration tests
        run: |
          pytest -q tests/test_concurrency_cap.py::test_concurrency_cap_applies tests/test_warm_mode_domain_skip.py::test_warm_mode_filters_out_node_checks -q
